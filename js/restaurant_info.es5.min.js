"use strict";var map,restaurant=void 0;registerServiceWorker=function(){navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js")},registerServiceWorker(),window.initMap=function(){self.restaurant&&(self.map=new google.maps.Map(document.getElementsByClassName("map")[0],{zoom:16,center:self.restaurant.latlng,scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))},fetchRestaurantFromURL=function(e){if(self.restaurant)e(null,self.restaurant);else{var t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,function(t,a){self.restaurant=a,a?(fillRestaurantHTML(),e(null,a)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}},fillRestaurantHTML=function(){var e=arguments.length<=0||void 0===arguments[0]?self.restaurant:arguments[0];document.getElementsByClassName("restaurant-name")[0].innerHTML=e.name;document.getElementsByClassName("restaurant-address")[0].innerHTML=e.address;var t=document.getElementsByClassName("restaurant-img")[0];t.className="restaurant-img";var a=""+["180w","304w","428w","552w","676w","800w"].map(function(t){return"img/"+e.id+"-"+t+".jpg "+t}).join(", ");t.setAttribute("srcset",a),t.setAttribute("sizes","(max-width: 614px) calc(100vw - 2px), (max-width: 1189px) calc((100vw - 3 * 35px - 2 * 2px) / 2), (max-width: 1399px) calc((100vw - 4 * 35px - 3 * 2px) / 3), (min-width: 1400px) 409px"),t.src="img/"+e.id+"-552w.jpg",t.alt=e.name+" Restaurant";document.getElementsByClassName("restaurant-cuisine")[0].innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fetchReviews()},fillRestaurantHoursHTML=function(){var e=arguments.length<=0||void 0===arguments[0]?self.restaurant.operating_hours:arguments[0],t=document.getElementsByClassName("restaurant-hours")[0];for(var a in e){var n=document.createElement("tr"),r=document.createElement("th");r.innerHTML=a,n.appendChild(r);var i=document.createElement("td");e[a];i.innerHTML=e[a].replace(",",", <br>"),n.appendChild(i),t.appendChild(n)}},fetchReviews=function(){DBHelper.fetchReviewsByRestaurantId(self.restaurant.id,function(e){fillReviewsHTML(e)})},fillReviewsHTML=function(e){document.querySelector(".reviews-container > h3");var t=document.getElementsByClassName("reviews-container")[0];t.innerHTML="";var a=document.createElement("h3");if(a.innerHTML="Reviews",t.appendChild(a),0===e.length){var n=document.createElement("p");return n.innerHTML="No reviews yet!",void t.appendChild(n)}var r=document.createElement("ul");r.className="reviews-list",e.forEach(function(e){r.appendChild(createReviewHTML(e))}),r.appendChild(createNewReviewFormHTML()),t.appendChild(r)},createReviewHTML=function(e){var t=document.createElement("li"),a=document.createElement("p");a.innerHTML=e.name,a.className="reviewer-name",t.appendChild(a);var n=document.createElement("p");n.innerHTML=new Date(e.updatedAt).toDateString(),n.className="review-date",t.appendChild(n);var r=document.createElement("p");r.innerHTML="Rating: "+e.rating+" / 5",r.className="review-rating",t.appendChild(r);var i=document.createElement("p");return i.innerHTML=e.comments,i.className="review-text",t.appendChild(i),t},createNewReviewFormHTML=function(){var e=document.createElement("label");e.setAttribute("for","new-review-name"),e.textContent="Name:";var t=document.createElement("input");t.setAttribute("name","new-review-name"),t.setAttribute("id","new-review-name"),t.setAttribute("type","text"),t.setAttribute("placeholder","John Smith");var a=document.createElement("label");a.setAttribute("for","new-review-rating"),a.textContent="Rating:";var n=document.createElement("input");n.setAttribute("name","new-review-rating"),n.setAttribute("id","new-review-rating"),n.setAttribute("type","range"),n.setAttribute("min","1"),n.setAttribute("max","5"),n.setAttribute("value","3"),n.addEventListener("input",function(){for(var e=0;e<5;e++){r.children.item(e).className=e<n.value?"rated-star":"empty-star"}}),n.addEventListener("focusin",function(){r.classList.add("focused")}),n.addEventListener("focusout",function(){r.classList.remove("focused")});var r=document.createElement("output");r.setAttribute("aria-hidden","true"),r.setAttribute("for","new-review-rating"),r.setAttribute("name","stars-rating");for(var i=0;i<5;i++){var l=document.createElement("div");l.textContent="â˜…",l.className=i<3?"rated-star":"empty-star",r.appendChild(l)}var o=document.createElement("label");o.setAttribute("for","new-review-text"),o.textContent="Comment:";var s=document.createElement("textarea");s.setAttribute("id","new-review-text"),s.setAttribute("name","new-review-text"),s.setAttribute("rows","5"),s.setAttribute("placeholder","Write about your experience at this restaurant...");var d=document.createElement("button");d.textContent="Submit Review",d.addEventListener("click",function(e){e.preventDefault(),m.parentNode.removeChild(m);var a=""!=t.value?t.value:"Anonymous",r=""!=s.value?s.value:a+" provided no comment.",i={restaurant_id:self.restaurant.id,name:a,rating:n.value,comments:r,createdAt:new Date(Date.now()).toJSON(),updatedAt:new Date(Date.now()).toJSON()};document.querySelector(".reviews-list").appendChild(createReviewHTML(i)),DBHelper.postNewReview(i)});var c=document.createElement("form");c.setAttribute("name","new-review"),c.setAttribute("id","new-review"),c.appendChild(e),c.appendChild(t),c.appendChild(a),c.appendChild(n),c.appendChild(r),c.appendChild(o),c.appendChild(s),c.appendChild(d);var u=document.createElement("h4");u.textContent="Add Your Review!";var m=document.createElement("li");return m.appendChild(u),m.appendChild(c),m.setAttribute("id","new-review-form-li"),m},fillBreadcrumb=function(){var e=arguments.length<=0||void 0===arguments[0]?self.restaurant:arguments[0],t=document.querySelector(".breadcrumb ol"),a=document.createElement("li");a.innerHTML=e.name,a.setAttribute("aria-current","page"),t.appendChild(a)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null},loadGoogleMapsPreviewImage=function(e){var t=document.querySelector(".map-overlay"),a=document.querySelector(".map"),n=document.querySelector(".map-preview"),r=document.querySelector(".map-container");t.onclick=function(){t.style.display="none",t.parentNode.removeChild(t),a.style.display="block",self.map&&google.maps.event.addDomListenerOnce(self.map,"tilesloaded",function(){n.parentNode.removeChild(n),a.style.position="relative"})};window.getComputedStyle(a);var i=Math.trunc(window.innerWidth),l=r.offsetHeight,o="&markers=size:%7Ccolor:0xff0000%7Clabel:%7C"+e.latlng.lat+",+"+e.latlng.lng;n.src="https://maps.googleapis.com/maps/api/staticmap?center="+e.latlng.lat+",+"+e.latlng.lng+"&zoom=16&scale=1&size="+i+"x"+l+"&maptype=roadmap&format=jpg&visual_refresh=true"+o+"&key=AIzaSyD7U9qcVcdpFFnhE9Gj7fJ87TU6SbL0OoE"},loadRestaurantDataAndGenerateStaticGoogleMapsImageLink=function(){var e=getParameterByName("id");e?DBHelper.fetchRestaurantById(e,function(e,t){self.restaurant=t,t?(window.google&&window.initMap(),fillRestaurantHTML(),fillBreadcrumb(),loadGoogleMapsPreviewImage(t)):console.error(e)}):error="No restaurant id in URL"},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(e){loadRestaurantDataAndGenerateStaticGoogleMapsImageLink()}):loadRestaurantDataAndGenerateStaticGoogleMapsImageLink(),document.getElementById("gmaps-script-element").src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD7U9qcVcdpFFnhE9Gj7fJ87TU6SbL0OoE&libraries=places&callback=initMap";