"use strict";function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),indexDBPromise=idb.open("Restaurant Reviews",1,function(t){switch(t.oldVersion){case 0:t.createObjectStore("restaurants",{keyPath:"id"})}}),DBHelper=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"fetchRestaurants",value:function(n){indexDBPromise.then(function(e){var r=e.transaction("restaurants","readwrite").objectStore("restaurants");r.count().then(function(u){u>0?(r=e.transaction("restaurants","readwrite").objectStore("restaurants")).getAll().then(function(t){n(null,t)}):fetch(t.DATABASE_URL).then(function(t){if(t.ok)t.json().then(function(t){n(null,t),r=e.transaction("restaurants","readwrite").objectStore("restaurants"),t.forEach(function(t){r.put(t)})});else{var u="Request failed. Returned status of "+t.status;n(u,null)}})})})}},{key:"fetchRestaurantById",value:function(n,e){t.fetchRestaurants(function(t,r){if(t)e(t,null);else{var u=r.find(function(t){return t.id==n});u?e(null,u):e("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(n,e){t.fetchRestaurants(function(t,r){if(t)e(t,null);else{var u=r.filter(function(t){return t.cuisine_type==n});e(null,u)}})}},{key:"fetchRestaurantByNeighborhood",value:function(n,e){t.fetchRestaurants(function(t,r){if(t)e(t,null);else{var u=r.filter(function(t){return t.neighborhood==n});e(null,u)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(n,e,r){t.fetchRestaurants(function(t,u){if(t)r(t,null);else{var a=u;"all"!=n&&(a=a.filter(function(t){return t.cuisine_type==n})),"all"!=e&&(a=a.filter(function(t){return t.neighborhood==e})),r(null,a)}})}},{key:"fetchNeighborhoods",value:function(n){t.fetchRestaurants(function(t,e){t?n(t,null):function(){var t=e.map(function(t,n){return e[n].neighborhood}),r=t.filter(function(n,e){return t.indexOf(n)==e});n(null,r)}()})}},{key:"fetchCuisines",value:function(n){t.fetchRestaurants(function(t,e){t?n(t,null):function(){var t=e.map(function(t,n){return e[n].cuisine_type}),r=t.filter(function(n,e){return t.indexOf(n)==e});n(null,r)}()})}},{key:"urlForRestaurant",value:function(t){return"./restaurant.html?id="+t.id}},{key:"imageUrlForRestaurant",value:function(t){return"/img/"+t.photograph}},{key:"mapMarkerForRestaurant",value:function(n,e){return new google.maps.Marker({position:n.latlng,title:n.name,url:t.urlForRestaurant(n),map:e,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),t}();