"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var map,_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),indexDBPromise=idb.open("Restaurant Reviews",1,function(e){switch(e.oldVersion){case 0:e.createObjectStore("restaurants",{keyPath:"id"})}}),DBHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"fetchRestaurants",value:function(t){indexDBPromise.then(function(n){var r=n.transaction("restaurants","readwrite").objectStore("restaurants");r.count().then(function(o){o>0?(r=n.transaction("restaurants","readwrite").objectStore("restaurants")).getAll().then(function(e){t(null,e)}):fetch(e.DATABASE_URL).then(function(e){if(e.ok)e.json().then(function(e){t(null,e),r=n.transaction("restaurants","readwrite").objectStore("restaurants"),e.forEach(function(e){r.put(e)})});else{var o="Request failed. Returned status of "+e.status;t(o,null)}})})})}},{key:"fetchRestaurantById",value:function(t,n){e.fetchRestaurants(function(e,r){if(e)n(e,null);else{var o=r.find(function(e){return e.id==t});o?n(null,o):n("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(t,n){e.fetchRestaurants(function(e,r){if(e)n(e,null);else{var o=r.filter(function(e){return e.cuisine_type==t});n(null,o)}})}},{key:"fetchRestaurantByNeighborhood",value:function(t,n){e.fetchRestaurants(function(e,r){if(e)n(e,null);else{var o=r.filter(function(e){return e.neighborhood==t});n(null,o)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(t,n,r){e.fetchRestaurants(function(e,o){if(e)r(e,null);else{var i=o;"all"!=t&&(i=i.filter(function(e){return e.cuisine_type==t})),"all"!=n&&(i=i.filter(function(e){return e.neighborhood==n})),r(null,i)}})}},{key:"fetchNeighborhoods",value:function(t){e.fetchRestaurants(function(e,n){e?t(e,null):function(){var e=n.map(function(e,t){return n[t].neighborhood}),r=e.filter(function(t,n){return e.indexOf(t)==n});t(null,r)}()})}},{key:"fetchCuisines",value:function(t){e.fetchRestaurants(function(e,n){e?t(e,null):function(){var e=n.map(function(e,t){return n[t].cuisine_type}),r=e.filter(function(t,n){return e.indexOf(t)==n});t(null,r)}()})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.photograph}},{key:"mapMarkerForRestaurant",value:function(t,n){return new google.maps.Marker({position:t.latlng,title:t.name,url:e.urlForRestaurant(t),map:n,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),e}(),restaurants=void 0,neighborhoods=void 0,cuisines=void 0,restaurantImagesIntersectionObserver=void 0,markers=[];IntersectionObserver&&(restaurantImagesIntersectionObserver=new IntersectionObserver(function(e){e.forEach(function(e){var t=e.target;if(e.intersectionRatio>0){var n=""+["180w","304w","428w","552w","676w","800w"].map(function(e){return"img/"+t.getAttribute("restaurant-id")+"-"+e+".jpg "+e}).join(", ");t.setAttribute("srcset",n),t.setAttribute("sizes","(max-width: 499px) calc(100vw - 34px), (max-width: 799px) calc((100vw - 3 * 20px - 2 * 34px) / 2), (max-width: 1023px) calc((100vw - 4 * 20px - 3 * 34px) / 3), (min-width: 1024px) 281px"),t.src="img/"+t.getAttribute("restaurant-id")+"-552w.jpg",restaurantImagesIntersectionObserver.unobserve(t)}})})),registerServiceWorker=function(){navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js")},registerServiceWorker(),fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(e,t){e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var e=arguments.length<=0||void 0===arguments[0]?self.neighborhoods:arguments[0],t=document.getElementById("neighborhoods-select");e.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,t){e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=arguments.length<=0||void 0===arguments[0]?self.cuisines:arguments[0],t=document.getElementById("cuisines-select");e.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})},window.initMap=function(){self.map=new google.maps.Map(document.getElementsByClassName("map")[0],{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()},updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,o=e[n].value,i=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(o,i,function(e,t){e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[];document.getElementsByClassName("restaurants-list")[0].innerHTML="",self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=arguments.length<=0||void 0===arguments[0]?self.restaurants:arguments[0],t=document.getElementsByClassName("restaurants-list")[0];e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap()},createRestaurantHTML=function(e){var t=document.createElement("li"),n=document.createElement("header");n.className="restaurant-header",t.append(n);var r=document.createElement("img");if(r.className="restaurant-img",r.setAttribute("restaurant-id",e.id),restaurantImagesIntersectionObserver)restaurantImagesIntersectionObserver.observe(r);else{var o=""+["180w","304w","428w","552w","676w","800w"].map(function(t){return"img/"+e.id+"-"+t+".jpg "+t}).join(", ");r.setAttribute("srcset",o),r.setAttribute("sizes","(max-width: 614px) calc(100vw - 2 * 36px), (max-width: 1189px) calc((100vw - 3 * 35px - 2 * 2px) / 2), (max-width: 1399px) calc((100vw - 4 * 35px - 3 * 2px) / 3), (min-width: 1400px) 409px"),r.src="img/"+e.id+"-552w.jpg"}r.alt=e.name+" Restaurant",n.append(r);var i=document.createElement("h2");i.innerHTML=e.name,i.id="restaurant-"+e.id+"-name",n.append(i);var a=document.createElement("p");a.innerHTML=e.neighborhood,t.append(a);var s=document.createElement("p");s.innerHTML=e.address,t.append(s);var u=document.createElement("a");return u.innerHTML="View Details",u.setAttribute("aria-labelledby",i.id),u.href=DBHelper.urlForRestaurant(e),t.append(u),t},addMarkersToMap=function(){(arguments.length<=0||void 0===arguments[0]?self.restaurants:arguments[0]).forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})},document.getElementById("neighborhoods-select").onchange=updateRestaurants,document.getElementById("cuisines-select").onchange=updateRestaurants,document.getElementById("gmaps-script-element").src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD7U9qcVcdpFFnhE9Gj7fJ87TU6SbL0OoE &libraries=places&callback=initMap","loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(e){fetchNeighborhoods(),fetchCuisines()}):(fetchNeighborhoods(),fetchCuisines()),function(){function e(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function t(t,n,r){var o,i=new Promise(function(i,a){e(o=t[n].apply(t,r)).then(i,a)});return i.request=o,i}function n(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function r(e,n,r,o){o.forEach(function(o){o in r.prototype&&(e.prototype[o]=function(){return t(this[n],o,arguments)})})}function o(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})})}function i(e,n,r,o){o.forEach(function(o){o in r.prototype&&(e.prototype[o]=function(){return function(e,n,r){var o=t(e,n,r);return o.then(function(e){if(e)return new s(e,o.request)})}(this[n],o,arguments)})})}function a(e){this._index=e}function s(e,t){this._cursor=e,this._request=t}function u(e){this._store=e}function c(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new c(n)}function f(e){this._db=e}n(a,"_index",["name","keyPath","multiEntry","unique"]),r(a,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),i(a,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(s,"_cursor",["direction","key","primaryKey","value"]),r(s,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(s.prototype[t]=function(){var n=this,r=arguments;return Promise.resolve().then(function(){return n._cursor[t].apply(n._cursor,r),e(n._request).then(function(e){if(e)return new s(e,n._request)})})})}),u.prototype.createIndex=function(){return new a(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new a(this._store.index.apply(this._store,arguments))},n(u,"_store",["name","keyPath","indexNames","autoIncrement"]),r(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),i(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),o(u,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},n(c,"_tx",["objectStoreNames","mode"]),o(c,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},n(l,"_db",["name","version","objectStoreNames"]),o(l,"_db",IDBDatabase,["deleteObjectStore","close"]),f.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},n(f,"_db",["name","version","objectStoreNames"]),o(f,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[u,a].forEach(function(t){t.prototype[e.replace("open","iterate")]=function(){var t=function(e){return Array.prototype.slice.call(e)}(arguments),n=t[t.length-1],r=this._store||this._index,o=r[e].apply(r,t.slice(0,-1));o.onsuccess=function(){n(o.result)}}})}),[a,u].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,r=[];return new Promise(function(o){n.iterateCursor(e,function(e){e?(r.push(e.value),void 0===t||r.length!=t?e.continue():o(r)):o(r)})})})});var d={open:function(e,n,r){var o=t(indexedDB,"open",[e,n]),i=o.request;return i.onupgradeneeded=function(e){r&&r(new l(i.result,e.oldVersion,i.transaction))},o.then(function(e){return new f(e)})},delete:function(e){return t(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();